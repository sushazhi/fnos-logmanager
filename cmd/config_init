#!/bin/bash

# 飞牛日志管理配置初始化脚本

echo "正在验证配置..."

# 验证端口
PORT="${wizard_app_port:-8090}"
if ! [[ "$PORT" =~ ^[0-9]+$ ]] || [ "$PORT" -lt 1 ] || [ "$PORT" -gt 65535 ]; then
    echo "Error: Invalid port number" > "$TRIM_TEMP_LOGFILE"
    exit 1
fi

# 检查端口占用（如果不是当前端口）
CURRENT_PORT="${TRIM_SERVICE_PORT:-8090}"
if [ "$PORT" != "$CURRENT_PORT" ]; then
    if netstat -tuln 2>/dev/null | grep -q ":$PORT " || ss -tuln 2>/dev/null | grep -q ":$PORT "; then
        echo "Error: Port $PORT is already in use" > "$TRIM_TEMP_LOGFILE"
        exit 1
    fi
fi

echo "配置验证通过"
exit 0
